/****************************************                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          /***********************************        GayBlade   Ver 1.0.0      ****      © Copyright by Ryan Best 1992  ****          All Rights Reserved.       *******************************************/#include "GB.h"extern	WindowPtr	gPictureWindow, gGameWindow, gCastleWindow;extern	Boolean		gDone, gWNEImplemented;extern	EventRecord	gTheEvent;extern	MenuHandle	gAppleMenu,gFileMenu,gOptionsMenu,gSpecialMenu;extern	Rect		gIntroRect, gTavernRect, gBankRect, gRollerRect, gStoreRect, gCharRect0,					gCharRect1, gCharRect2, gCharRect3,gItemsRect, gMapRect, gSpellsRect,gSrcRect,					gGuildRect,gHealerRect,gdungeonRect, gStatsRect, gPartyInfoRect,					gUseRect,gPanicRect, gMoveRect, gDungDispRect, gActionRect,gConsoleRect, 					gMScreenRect,leftRect,centerRect,rightRect,cLeftRect,cCenterRect,cRightRect,					doorRect,clwallRect,crwallRect,cRect, gChestRect,gItemRect,gListStatsRect,					gListItemsRect, gCompassRect,gTreasureRect;extern	PicHandle	gThePicture, gConsolePicture, gDungeon1, gLeftWall, gCenterWall, gRightWall,					gLeftDoor,gRightDoor,gFlatWall,gFlatDoor,gOpenSpace,gFarWall,gFarDoor,gCLWall,gCRWall,					gCOpenSpace,gCLDoor,gCRDoor,gCFWall,gCFDoor, gMScreenPicture;extern	CIconHandle	gVialIcon,gShieldIcon, gRingIcon, gSphereIcon,gFlailIcon,gCloakIcon,gArrowIcon,gDaggerIcon,					gSwordIcon,gHelmetIcon,gTorchIcon,gBookIcon,gGlovesIcon,gBurnedIcon,gArmorIcon,					gChestIcon, gCompassIcon,gCNorthIcon,gCSouthIcon,gCEastIcon,					gCWestIcon;extern int			gSndOn,gPanicOn, gInCastle, gPartyNum,gNewChar, gSndNum, gLastChar, gLight,					gLightSpell,gItemUseScreen, gCurChar, gInPrison,gDialogNum,gDisplay,gDungLevel,gXLoc,gYLoc,					gView,gResistFire,gResistIce,gPartyInvis,gInEncounter,gCureWho,gFoundItems[3],					gCreatType, gCreatureCounter, gCreatHits[10],gLevelCount,dmgType,gTreasure,					gDisarmSpellCast,gCompass,ASave,gMagicItems[4],gSpeed,gCharShields[4],gEvade;extern	long		gStats[6], gDungParty[4],gWhichChar,glastWhen,gPanic;extern	Point		glastWhere;extern	DialogPtr	gCastleDialog;extern	RGBColor	gNameBack, gStatsBack, gSpecName,gNormName,gMessBack,gBlack,gStatsFore;extern	CCrsrHandle	gSpellCursor;extern	SFReply		fileName;extern	struct	CharInfo {	Str255	name;	int		type;	int		race;	int		level;	int		exp;	int		status;	int		hits;	int		dmg;	int		age;	int		str;	int		wis;	int		itl;	int		con;	int		dex;	int		items[7];		int		itemsInUse[7];			/* what items are being used */	int		gold;	int	 	bank;					/* released wizard? */	int		mspells[4],cspells[4];	int		dngLevel, xLoc, yLoc,Pos;	};extern	struct	CharInfo	GameChars[8];						/*  Can store up to 8 chars per game  */extern	struct	ItemInfo {	Str255			name;	unsigned char	type;	unsigned char	status;		/* whether item is in use or not */	unsigned char	instore;	unsigned char	level;	Byte			attrib;	unsigned char	dmg;	unsigned char	def;	unsigned char	con;};extern	struct	ItemInfo	GameItems[101];extern	struct	DungInfo 				{	unsigned int	XY[10][10];		/*  x, y  rooms location */	unsigned int	N[100];			/* 100 rooms w/north walls */	unsigned int	S[100];			/* 100 rooms w/south walls */	unsigned int	E[100];			/* 100 rooms w/east walls */	unsigned int	W[100];			/* 100 rooms w/west walls */	unsigned int	SA[100];};extern	struct	DungInfo	Dungeon[1];	extern struct	CreatureInfo 				/* access database each encounter */{	Str255			name;	unsigned char	type;	unsigned char	status;		/* For use in editor only */	unsigned char	instore;	/* Unused variable */	unsigned char	level;	Byte			attrib;	Byte			dmg;	Byte			def;	Byte			hits;};extern struct	CreatureInfo	GameCreatures[1];/************************ Items ****************************/Items()		 {int				slot, z=0,x,y,badItem,itemNum; Handle			itemHandle;Rect			itemRect,destRect,worldBounds;Str255			theText;short			status;GWorldPtr		world;GWorldPtr		MakeGWorld();Point			mouseLoc;if (gDisplay==1)				/* if not on items screen,leave */	return;		GetMouse(&mouseLoc);		y = 195;		for (x=0;x<=6;x++)				/* find out which item selected */	{		SetRect(&itemRect,378,y+(x*20),394,y+16+(x*20));		if (PtInRect(mouseLoc, &itemRect))			{				itemNum=x;						break;			}		z++;		}	if (z == 7 || GameChars[gCurChar].items[x]==101)	{		gItemUseScreen=NO;			/* INVALID ITEM, so reset it! */		return(NO);  				/* not valid item at x,y loc */	}	if (gTheEvent.what == mouseDown && gTheEvent.modifiers==512) 		/* SHIFT key dwn */				{			RGBForeColor(white);			RGBBackColor(black);			gPanic=YES;		/* start copybits here, above subRs cant use it */			SetRect(&worldBounds,33,33,364,299);							SetRect(&destRect,33,33,364,299);				world=MakeGWorld(&worldBounds);		SetRect(&gMScreenRect,0,0,331,266);				 				CopyIntroBits(world,&gMScreenRect);	/* copy mRect screen */					ItemStats(itemNum,itemRect);				RGBForeColor(white);			RGBBackColor(black); 	 		CopyWorldBits(world,&gMScreenRect);		/* Update console screen */	     SetRect(&gMScreenRect,33,33,331,266);	 	 	DisposeGWorld(world);		 	}															else if (gTheEvent.what == mouseDown && 			/* USING ITEM*/		gItemUseScreen==YES)			ChooseItem(itemNum,itemRect);				else if (gTheEvent.what == mouseDown && gTheEvent.modifiers==2048) 			EquipItems(itemNum);   						/* OPTION key down */	else if (gTheEvent.what == mouseDown)		{			gPanic=YES;		/* start copybits here, above subRs cant use it */			RGBForeColor(white);			RGBBackColor(black); 			SetRect(&worldBounds,33,33,364,299);							SetRect(&destRect,33,33,364,299);				world=MakeGWorld(&worldBounds);		      SetRect(&gMScreenRect,0,0,331,266);				 				CopyIntroBits(world,&gMScreenRect);	/* copy mRect screen */						DragItem(itemNum,itemRect);						RGBForeColor(white);				RGBBackColor(black);		 		CopyWorldBits(world,&gMScreenRect);		/* Update console screen */	     SetRect(&gMScreenRect,33,33,331,266);			 	DisposeGWorld(world);			}			gItemUseScreen=NO;			/* reset item selection */	return(YES);					/* valid item selected */}/************************ UpdateItems ****************************/UpdateItems (itemNum)int		itemNum;{		int		x,z,badItem;	ClearMessage();  if (GameChars[gCurChar].itemsInUse[itemNum] != OPENSLOT)		/* stop using it */  	{  		DeEquipItem(itemNum);			/* Modify stats, other stuff by DE-EQUIPPING item */			ClearMessage();					/* reset color in mssg. update wind. */  		DrawString(GameChars[gCurChar].name);		DrawString("\p is no longer equipping the ");		GameChars[gCurChar].itemsInUse[itemNum] = OPENSLOT;					}  else if (GameChars[gCurChar].itemsInUse[itemNum] == OPENSLOT)  	{  		badItem=CheckType(itemNum);  		if (badItem==-1)				/* item/char no good or already in use */  			return(badItem);  		if (gInEncounter==YES &&   			GameItems[GameChars[gCurChar].items[itemNum]].type==TORCH)  			{  				ClearMessage();  				DrawString("\pYou can't light a lighter right now!");  				Pause();  				return;  			}		  		DrawString(GameChars[gCurChar].name);			DrawString("\p has equipped the ");		GameChars[gCurChar].itemsInUse[itemNum]=GameChars[gCurChar].items[itemNum];	  EquipItem(itemNum);				/* Modify stats, other stuff by actually EQUIPPING item */		}		RGBForeColor(&gNormName);		/* safety check for screen colors */			RGBBackColor(&gMessBack);					switch (GameItems[GameChars[gCurChar].items[itemNum]].type)					{				 	case MAGICVIAL:			 						  DrawString("\pMagic Vial.");					  	gSndNum=22835;											PlaySound();					  					break; 									 	case SWORD:			 						  DrawString("\pNails.");					  	gSndNum=23585;											PlaySound();					  					break;   					case DAGGER:			 						  DrawString("\pMace.");					  	gSndNum=28045;											PlaySound();					break;					case SHIELD:			 						  DrawString("\pCondom.");					  	gSndNum=2652;											PlaySound();					  					break;										case HELMET:			 						  DrawString("\pTiara.");					  	gSndNum=8764;											PlaySound();					break;										case FLAIL:			 						  DrawString("\pBlo Dryer.");					  	gSndNum=20185;											PlaySound();					break;					case GAUNTLETS:			 						  DrawString("\pPurse.");					  	gSndNum=7123;											PlaySound();					  					break;						case CLOAK:			 						  DrawString("\pApron.");					  	gSndNum=24317;											PlaySound();					  					break;					case TORCH:			 						  DrawString("\pLighter.");					  	gSndNum=29620;											PlaySound();					  					break;										case ARMOR:			 						  DrawString("\pL. Jacket.");					  	gSndNum=22694;											PlaySound();					  					break;					case RING:			 						  gSndNum=4117;											PlaySound();						DrawString("\pRing.");					break;						case SPHERE:			 						  DrawString("\pSphere.");					  	gSndNum=4677;											PlaySound();					  					break;					case BURNEDITEM:			 						  DrawString("\pburned item.");					break;					}							}/************************ CheckType ****************************//*******      Check if item & char is valid types             **/CheckType(itemNum)int		itemNum;{		int		x,z,badItem;/** MAGE & CLERIC RESTRICTIONS: **/if (GameChars[gCurChar].type==2 || GameChars[gCurChar].type==4)	{																		/* WEAPON RESTRICTS */if (GameItems[GameChars[gCurChar].items[itemNum]].type == 1 || 			/* sword */		GameItems[GameChars[gCurChar].items[itemNum]].type == 3)		/* flail */	{		ClearMessage();		DrawString(GameChars[gCurChar].name);		DrawString("\p cannot hold that type of weapon.");		badItem=-1;		return(badItem);	}																		/* ARMOR RESTRICTS */if (GameItems[GameChars[gCurChar].items[itemNum]].type == 4 || 				/* gauntlet */		GameItems[GameChars[gCurChar].items[itemNum]].type == 6 ||			/* armor */		   GameItems[GameChars[gCurChar].items[itemNum]].type == 7 ||		/* shield */		   		GameItems[GameChars[gCurChar].items[itemNum]].type == 8)	/* helmet */	{		ClearMessage();		DrawString(GameChars[gCurChar].name);		DrawString("\p cannot wear that type of armor.");		badItem=-1;		return(badItem);	}}	if (GameChars[gCurChar].type==1)				/** SAMMIES **/{																		/* WEAPON RESTRICTS */if (GameItems[GameChars[gCurChar].items[itemNum]].type == 1 || 			/* sword */		GameItems[GameChars[gCurChar].items[itemNum]].type == 3)		/* flail */	{		ClearMessage();		DrawString(GameChars[gCurChar].name);		DrawString("\p cannot hold that type of weapon.");		badItem=-1;		return(badItem);	}																		/* ARMOR RESTRICTS */if (GameItems[GameChars[gCurChar].items[itemNum]].type == 6 || 				/* armor */		   GameItems[GameChars[gCurChar].items[itemNum]].type == 7)		/* shield */	{		ClearMessage();		DrawString(GameChars[gCurChar].name);		DrawString("\p cannot wear that type of armor.");		badItem=-1;		return(badItem);	}}	  /**  CHECK IF TYPE OF WEAP. ALREADY IN USE!  DISALLOW IF SO **/ 	if (GameItems[GameChars[gCurChar].items[itemNum]].type == SWORD ||		GameItems[GameChars[gCurChar].items[itemNum]].type == DAGGER ||		GameItems[GameChars[gCurChar].items[itemNum]].type == FLAIL ||		GameItems[GameChars[gCurChar].items[itemNum]].type == GAUNTLETS)		{			for (x=0;x<=6;x++)			/* search through all items */				{				if (GameChars[gCurChar].itemsInUse[x] != OPENSLOT)					{						if (GameItems[GameChars[gCurChar].itemsInUse[x]].type ==							SWORD ||							GameItems[GameChars[gCurChar].itemsInUse[x]].type ==							DAGGER ||							GameItems[GameChars[gCurChar].itemsInUse[x]].type ==							FLAIL ||							GameItems[GameChars[gCurChar].itemsInUse[x]].type ==							GAUNTLETS)							{								ClearMessage();								DrawString(GameChars[gCurChar].name);								DrawString("\p is already holding a weaponÉ");								badItem=-1;								return(badItem);							} 					} 				} 		} 		 /**  CHECK IF SHIELD ALREADY IN USE **/  	if (GameItems[GameChars[gCurChar].items[itemNum]].type == SHIELD) 	 {		for (x=0;x<=6;x++)			/* search through all items */			{			if (GameChars[gCurChar].itemsInUse[x] != OPENSLOT)				{					if (GameItems[GameChars[gCurChar].itemsInUse[x]].type ==						SHIELD)						{							ClearMessage();							DrawString(GameChars[gCurChar].name);							DrawString("\p is already wearing a Condom!");							badItem=-1;							return(badItem);						}				}			}		}	 /**  CHECK IF CLOAK ALREADY IN USE **/  	if (GameItems[GameChars[gCurChar].items[itemNum]].type == CLOAK) 	 {		for (x=0;x<=6;x++)			/* search through all items */			{			if (GameChars[gCurChar].itemsInUse[x] != OPENSLOT)				{					if (GameItems[GameChars[gCurChar].itemsInUse[x]].type ==						CLOAK)						{							ClearMessage();							DrawString(GameChars[gCurChar].name);							DrawString("\p is already wearing an Apron.");							badItem=-1;							return(badItem);						}				}			}		}			 /**  CHECK IF HELMET ALREADY IN USE **/  	if (GameItems[GameChars[gCurChar].items[itemNum]].type == HELMET) 	 {		for (x=0;x<=6;x++)			/* search through all items */			{			if (GameChars[gCurChar].itemsInUse[x] != OPENSLOT)				{					if (GameItems[GameChars[gCurChar].itemsInUse[x]].type ==						HELMET)						{							ClearMessage();							DrawString(GameChars[gCurChar].name);							DrawString("\p already has a Tiara on.");							badItem=-1;							return(badItem);						}				}			}	} /**  CHECK IF ARMOR ALREADY IN USE **/  	if (GameItems[GameChars[gCurChar].items[itemNum]].type == ARMOR) 	 {		for (x=0;x<=6;x++)			/* search through all items */			{			if (GameChars[gCurChar].itemsInUse[x] != OPENSLOT)				{					if (GameItems[GameChars[gCurChar].itemsInUse[x]].type ==						ARMOR)						{							ClearMessage();							DrawString(GameChars[gCurChar].name);							DrawString("\p is already wearing a L. Jacket.");							badItem=-1;							return(badItem);						}				}			}	  } }/************************ EQUIPItems ****************************/EquipItems(itemNum)int		itemNum;{ int		badItem,z;Rect	arrowRect,eraseRect;	if (GameChars[gCurChar].items[itemNum]==OPENSLOT)		return;							/* no item in slot go away */	z=DeadCharMsg();					/* if char is dead, leave */	if (z==-1)	 	return;			badItem=UpdateItems(itemNum);	/* if not good, return */	if (badItem==-1)					/* else go on and check arrow */	 	return;	 			 SetRect(&arrowRect,380,218+(itemNum*20),396,234+(itemNum*20));	OffsetRect ( &arrowRect, -14, -20 );	if (GameChars[gCurChar].itemsInUse[itemNum]==OPENSLOT)		{	 		RGBForeColor(&gStatsBack); 				SetRect(&eraseRect,364,198+(itemNum*20),377,214+(itemNum*20));				PaintRect(&eraseRect);			RGBForeColor(&gNormName);					}	else		PlotCIcon(&arrowRect,gArrowIcon);	OffsetRect ( &arrowRect, +14, +20 );}	/************************ EquipItem ****************************/EquipItem(itemNum)			/** check attribs and modify when EQUIPPING ITEM  **/int		itemNum;{/*** LIGHT ***/if (GameItems[GameChars[gCurChar].itemsInUse[itemNum]].type==TORCH)												/** TORCH TURN LIGHT ON **/	{		gLight=ON;		UpdateDV();		}}/************************ DeEquipItem ****************************/DeEquipItem(itemNum)			/** check attribs and modify when DE-EQUIPPING ITEM  **/int		itemNum;{/*** LIGHT ***/if (GameItems[GameChars[gCurChar].itemsInUse[itemNum]].type==TORCH	&& gLightSpell != ON)		/** turn light off if spell not on **/	{		GameChars[gCurChar].itemsInUse[itemNum] = OPENSLOT;									 	gLight=OFF;			LightOff();					/* Paint screen black */	TorchAndLightOn();			/* go check any other torches now */	UpdateDV();		}}/************************ChooseItem for USE routines *************************/ChooseItem(itemNum,itemRect)int		itemNum;Rect	itemRect;{int				x,y,z,burnOut,tempChar,validChar;gItemUseScreen=NO;				/* reset 'USE' screen */	OffsetRect ( &itemRect, -1, -21 );	Pause();	if (GameItems[GameChars[gCurChar].items[itemNum]].attrib==0)	{	ClearMessage();		DrawString("\pThe ");		DrawString(GameItems[GameChars[gCurChar].items[itemNum]].name);	DrawString("\p does nothingÉ");	Pause();Pause();	}	ClearMessage();	/** BELOW LISTS ALL MAGICAL ITEMS WHICH CAN BE USED **/switch (GameItems[GameChars[gCurChar].items[itemNum]].attrib){	case MAGICVIAL:			ModifyItem(itemNum);	/* modify item type */		ClearMessage();		DrawString("\pYou quaff the potion inside...");		Pause();Pause();Pause();		MagicVial();		break;		case LIGHT:			CastLight();			burnOut=ItemBurnout(itemNum);	/* did item burnout?? */		if (burnOut==TRUE)				/* yes, then return */			return;		break;		case TELE1:			if (CheckTele() == -1)		  return;			gSndNum=25631;					/* teleport sound */		PlaySound();			DrawString("\pYou are now on level 12");		gLevelCount=11;			InitDungeon();					/* new walls? */						ReadDungeon();					UpdateDV();		burnOut=ItemBurnout(itemNum);	/* did item burnout?? */		if (burnOut==TRUE)				/* yes, then return */			return;			ClearMessage();				break;		case TELE2:		if (CheckTele() == -1)		  return;				gSndNum=25631;					/* teleport sound */		PlaySound();			DrawString("\pYou are now on level 2");		gLevelCount=1;			InitDungeon();					/* new walls? */								ReadDungeon();					UpdateDV();		burnOut=ItemBurnout(itemNum);	/* did item burnout?? */		if (burnOut==TRUE)				/* yes, then return */			return;			ClearMessage();				break;		case TELE3:		if (CheckTele() == -1)		  return;			gSndNum=25631;					/* teleport sound */		PlaySound();			DrawString("\pYou are now on level 3");		gLevelCount=2;		InitDungeon();					/* new walls? */									ReadDungeon();					UpdateDV();		burnOut=ItemBurnout(itemNum);	/* did item burnout?? */		if (burnOut==TRUE)				/* yes, then return */			return;			ClearMessage();				break;			case TELE4:		if (CheckTele() == -1)		  return;			gSndNum=25631;					/* teleport sound */		PlaySound();			DrawString("\pYou are now on level 4");		gLevelCount=3;			InitDungeon();					/* new walls? */								ReadDungeon();					UpdateDV();		burnOut=ItemBurnout(itemNum);	/* did item burnout?? */		if (burnOut==TRUE)				/* yes, then return */			return;			ClearMessage();				break;		case TELE5:		if (CheckTele() == -1)		  return;			gSndNum=25631;					/* teleport sound */		PlaySound();			DrawString("\pYou are now on level 5");		gLevelCount=4;			InitDungeon();					/* new walls? */								ReadDungeon();					UpdateDV();		burnOut=ItemBurnout(itemNum);	/* did item burnout?? */				if (burnOut==TRUE)				/* yes, then return */			return;			ClearMessage();				break;			case TELE6:		if (CheckTele() == -1)		  return;			gSndNum=25631;					/* teleport sound */		PlaySound();			DrawString("\pYou are now on level 6");		gLevelCount=5;		InitDungeon();					/* new walls? */									ReadDungeon();					UpdateDV();		burnOut=ItemBurnout(itemNum);	/* did item burnout?? */		if (burnOut==TRUE)				/* yes, then return */			return;			ClearMessage();				break;			case TELE7:		if (CheckTele() == -1)		  return;				gSndNum=25631;					/* teleport sound */		PlaySound();			DrawString("\pYou are now on level 7");		gLevelCount=6;			InitDungeon();					/* new walls? */								ReadDungeon();					UpdateDV();		burnOut=ItemBurnout(itemNum);	/* did item burnout?? */		if (burnOut==TRUE)				/* yes, then return */			return;			ClearMessage();				break;		case TELE8:		if (CheckTele() == -1)		  return;			gSndNum=25631;					/* teleport sound */		PlaySound();			DrawString("\pYou are now on level 8");		gLevelCount=7;		InitDungeon();					/* new walls? */									ReadDungeon();					UpdateDV();		burnOut=ItemBurnout(itemNum);	/* did item burnout?? */		if (burnOut==TRUE)				/* yes, then return */			return;			ClearMessage();				break;		case TELE9:		if (CheckTele() == -1)		  return;				gSndNum=25631;					/* teleport sound */		PlaySound();			DrawString("\pYou are now on level 9");		gLevelCount=8;		InitDungeon();					/* new walls? */									ReadDungeon();					UpdateDV();		burnOut=ItemBurnout(itemNum);	/* did item burnout?? */		if (burnOut==TRUE)				/* yes, then return */			return;			ClearMessage();				break;	case TELE10:		if (CheckTele() == -1)		  return;			gSndNum=25631;					/* teleport sound */		PlaySound();				DrawString("\pYou are now on level 10");		gLevelCount=9;		InitDungeon();					/* new walls? */									ReadDungeon();					UpdateDV();		burnOut=ItemBurnout(itemNum);	/* did item burnout?? */		if (burnOut==TRUE)				/* yes, then return */			return;			ClearMessage();				break;		case TELE11:		if (CheckTele() == -1)		  return;			gSndNum=25631;					/* teleport sound */		PlaySound();			DrawString("\pYou are now on level 11");		gLevelCount=10;			InitDungeon();					/* new walls? */								ReadDungeon();					UpdateDV();		burnOut=ItemBurnout(itemNum);	/* did item burnout?? */		if (burnOut==TRUE)				/* yes, then return */			return;			ClearMessage();				break;				case TELE12:		if (CheckTele() == -1)		  return;			gSndNum=25631;					/* teleport sound */		PlaySound();					DrawString("\pYou are now on level 12");		gLevelCount=11;		InitDungeon();					/* new walls? */									ReadDungeon();					UpdateDV();		burnOut=ItemBurnout(itemNum);	/* did item burnout?? */		if (burnOut==TRUE)				/* yes, then return */			return;			ClearMessage();				break;				case FIREBALLS:								FireBalls();					/* cast 'em */			CheckPartyDamage();				/* calculate damage & do updates */			burnOut=ItemBurnout(itemNum);	/* did item burnout?? */			if (burnOut==TRUE)				/* yes, then return */				return;				break;		case LIGHTNINGBOLTS:		LightningBolts();			burnOut=ItemBurnout(itemNum);	/* did item burnout?? */		if (burnOut==TRUE)				/* yes, then return */			return;		break;				case EYEOFDEATH:		EyeOfDeath();			burnOut=ItemBurnout(itemNum);	/* did item burnout?? */		if (burnOut==TRUE)				/* yes, then return */			return;		break;	case LOCATE:			Locate();				burnOut=ItemBurnout(itemNum);	/* did item burnout?? */			if (burnOut==TRUE)				/* yes, then return */				return;															break;			case WOUND:									Wound();		burnOut=ItemBurnout(itemNum);	/* did item burnout?? */		if (burnOut==TRUE)				/* yes, then return */			return;										break;					case ICESTORM:									IceStorm();		burnOut=ItemBurnout(itemNum);	/* did item burnout?? */		if (burnOut==TRUE)				/* yes, then return */			return;					break;	case INVIS:										Invis();		break;	case FIRESHIELD:										burnOut=ItemBurnout(itemNum);	/* did item burnout?? */			if (burnOut==TRUE)				/* yes, then return */				return;																FireShield();		break;	case ICESHIELD:										burnOut=ItemBurnout(itemNum);	/* did item burnout?? */			if (burnOut==TRUE)				/* yes, then return */				return;																IceShield();		break;	case EVADE:																					Evade();			burnOut=ItemBurnout(itemNum);	/* did item burnout?? */			if (burnOut==TRUE)				/* yes, then return */				return;							break;	case DISARM:										CastLight();		break;	case LIGHTHEAL:		burnOut=ItemBurnout(itemNum);	/* did item burnout?? */			if (burnOut==TRUE)				/* yes, then return */				return;							ClearMessage();					DrawString("\pHeal Who?");					Pause();				validChar=GetChar();						if (validChar==-1)				/* no valid char was selected */				return;			LightHeal();					break;		case FULLHEAL:			burnOut=ItemBurnout(itemNum);	/* did item burnout?? */			if (burnOut==TRUE)				/* yes, then return */				return;							ClearMessage();					DrawString("\pHeal Who?");					Pause();				validChar=GetChar();						if (validChar==-1)				/* no valid char was selected */				return;			FullHeal();					break;		case RAISEDEAD:			burnOut=ItemBurnout(itemNum);	/* did item burnout?? */			if (burnOut==TRUE)				/* yes, then return */				return;													ClearMessage();					DrawString("\pRaise Who?");					Pause();				validChar=GetChar();						if (validChar==-1)				/* no valid char was selected */				return;			RaiseDead();					break;	case HOME:																Home();						/* go home, QUICK!! */			burnOut=ItemBurnout(itemNum);	/* burnout = 100%  */				if (burnOut==TRUE)			/* will burnout    */					return;						break;	case DEXTERITY:										CastLight();		break;   }  Pause();}/************************ DragItem ****************************/DragItem(itemNum,itemRect)int		itemNum;Rect	itemRect;{RgnHandle		itemRgn;Point			thePoint,destPoint,mouseLoc;int				z,receiver=8,slot,result;long			release;GetMouse(&mouseLoc);	thePoint=mouseLoc;	itemRgn=NewRgn();							RectRgn(itemRgn,&itemRect);		release=DragGrayRgn(itemRgn,thePoint,&gConsoleRect,&gConsoleRect,0,0);	destPoint.v=thePoint.v+HiWord(release) ;	destPoint.h=thePoint.h+LoWord(release);	if (PtInRect(destPoint, &gCharRect0))			/************ CHAR 0 ***********/	receiver=gDungParty[0];else if (PtInRect(destPoint, &gCharRect1))		/************ CHAR 1 ***********/	receiver=gDungParty[1];	else if (PtInRect(destPoint, &gCharRect2))		/************ CHAR 2 ***********/	receiver=gDungParty[2];	else if (PtInRect(destPoint, &gCharRect3))		/************ CHAR 3 ***********/	receiver=gDungParty[3];if (GameChars[gCurChar].itemsInUse[z]!=OPENSLOT)	/* if item is IN USE */	{	 	ClearMessage();	 	DrawString("\pUnequip this item before moving it!");	 	Pause();Pause();	 	return;	 }	if (receiver>=0 && receiver <=7)	{  	  if(gCurChar==receiver)				/* ignore if given to same char! */	  	return;	  	if (GameChars[receiver].status==DEAD ||		GameChars[receiver].status==PERMDEAD)		{		ClearMessage();			DrawString(GameChars[receiver].name);			DrawString("\p can't receive items.");		return;		}	  		for (z=0;z<=6;z++)			{			if (GameChars[receiver].items[z]==OPENSLOT)				{				 	slot=z;				 	break;			/* slot found! */				 }				 		}			if (z == 7)				/* no slots open */				{					ClearMessage();			 		DrawString(GameChars[receiver].name);					DrawString("\p cannot carry more items!");			 		 					return;				}									/* add item to char! */			GameChars[receiver].items[slot]=GameChars[gCurChar].items[itemNum]; 			GameChars[gCurChar].items[itemNum]=OPENSLOT;				ClearMessage();			 		DrawString(GameChars[receiver].name);						DrawString("\p has received the ");					switch (GameItems[GameChars[receiver].items[slot]].type)					{				 	case MAGICVIAL:			 						  DrawString("\pMagic Vial.");					break; 									 	case SWORD:			 						  DrawString("\pNails.");					break;   					case DAGGER:			 						  DrawString("\pMace.");					break;					case SHIELD:			 						  DrawString("\pCondom.");					break;										case HELMET:			 						  DrawString("\pTiara.");					break;										case FLAIL:			 						  DrawString("\pBlo Dryer.");					break;					case GAUNTLETS:			 						  DrawString("\pPurse.");					break;						case CLOAK:			 						  DrawString("\pApron.");					break;					case TORCH:			 						  DrawString("\pLighter.");					break;										case ARMOR:			 						  DrawString("\pL. Jacket.");					break;					case RING:			 						  DrawString("\pRing.");					break;						case SPHERE:			 						  DrawString("\pSphere.");					break;					case BURNEDITEM:			 						  DrawString("\pburned item.");					break;					}								 	SortItems(); 			ListItems();		/*	  list CURRENT CHARS equip! */			return;	}	else if (PtInRect(destPoint, &gMScreenRect))		/***   DISCARD?   ****/	{		result=DropItem(itemNum);					/*** DON"T DISCARD! **/	if (result==YES)		{			ClearMessage();								/***  DO DISCARD!   **/		 	DrawString(GameChars[gCurChar].name);				DrawString("\p has discarded the ");					switch (GameItems[GameChars[gCurChar].items[itemNum]].type)					{				 	case MAGICVIAL:			 						  DrawString("\pMagic Vial.");					break; 									 	case SWORD:			 						  DrawString("\pNails.");					break;   					case DAGGER:			 						  DrawString("\pMace.");					break;					case SHIELD:			 						  DrawString("\pCondom.");					break;										case HELMET:			 						  DrawString("\pTiara.");					break;										case FLAIL:			 						  DrawString("\pBlo Dryer.");					break;					case GAUNTLETS:			 						  DrawString("\pPurse.");					break;						case CLOAK:			 						  DrawString("\pApron.");					break;					case TORCH:			 						  DrawString("\pLighter.");					break;										case ARMOR:			 						  DrawString("\pL. Jacket.");					break;					case RING:			 						  DrawString("\pRing.");					break;						case SPHERE:			 						  DrawString("\pSphere.");					break;					case BURNEDITEM:			 						  DrawString("\pburned item.");					break;					}					GameChars[gCurChar].items[itemNum]=OPENSLOT;					GameChars[gCurChar].itemsInUse[itemNum]=OPENSLOT;				SortItems(); 		 	ListItems();		/*  list CURRENT CHARS equip! */	 	}	}	}/************************ SortItems ****************************/SortItems(){int		z,x=0,tempItems[7],tempItems2[7];	for (z=0;z<=6;z++)		{		tempItems[z]=101;		tempItems2[z]=101;		}	for (z=0;z<=6;z++)		/* sort into temp holding array */			{			if (GameChars[gCurChar].items[z]!=101)			{				tempItems[x]=GameChars[gCurChar].items[z];				tempItems2[x]=GameChars[gCurChar].itemsInUse[z];				x++;			}		}	for (z=0;z<=6;z++)		/* now read back */		{		GameChars[gCurChar].items[z]=tempItems[z];		GameChars[gCurChar].itemsInUse[z]=tempItems2[z];		}}/************************ DropItem ****************************/DropItem(itemNum)int			itemNum;{int				itemType, itemHit,  result, dialogDone = FALSE;Handle			itemHandle;Rect			itemRect,worldBounds,destRect;Str255			text;short			status;GWorldPtr		world;GWorldPtr		MakeGWorld();/* RGBForeColor(white);	RGBBackColor(black);		SetRect(&destRect,33,33,331,266);		SetRect(&worldBounds,33,33,331,266);			world=MakeGWorld(&worldBounds); CopyIntroBits(world,&gMScreenRect);			  copy mRect screen gPanic=YES;  */		gDialogNum=7000;  DoDialog();					GetDItem(gCastleDialog, OKAY_ITEM, &itemType, &itemHandle, &itemRect);	PenSize(2,2);			InsetRect(&itemRect, -3,-3);		FrameRoundRect(&itemRect, 16, 16);	PenNormal();		ParamText("\pAre you sure you want to discard the ",GameItems[GameChars[gCurChar].items[itemNum]].name,"\p?",0);	while (dialogDone == FALSE)	{		ModalDialog(NIL_POINTER, &itemHit);			switch (itemHit)			{				case 1:								/* YES */					DisposeDialog(gCastleDialog);					dialogDone = TRUE;					SetPort(gGameWindow);						result=YES;					break;				case 2:					DisposeDialog(gCastleDialog);					dialogDone = TRUE;				/* NO */					SetPort(gGameWindow);					result=NO;										break;			}	}/* RGBForeColor(white);	RGBBackColor(black); 	 	CopyWorldBits(world,&gMScreenRect);		 Update console screen 	DisposeGWorld(world);	*/return(result);					}/************************ ListItems ****************************/ListItems()			/* displays item icons */{int			z,x,y; Rect		iconRect,itemRect;if (gDungParty[0]==99)						/* if no chars, leave */	return;SetPort(gGameWindow);	ClearBStats();		RGBBackColor(&gNameBack);					/* set bckgrnd color */	RGBForeColor(&gSpecName);	 				/* Update stats-area */  	x = 368;y = 177;	  		MoveTo(x,y); DrawString("\pÊÊÊÊÊÊÊÊÊÊÊÊÊÊÊ");  		MoveTo(x,y); DrawString(GameChars[gCurChar].name);  		x = 368;y = 192; MoveTo(x,y); DrawString("\pÊÊÊÊÊÊÊÊÊÊÊÊÊÊÊ");  	    	x = 368;y = 192;	MoveTo(x,y);										/* race */    	if (GameChars[gCurChar].race==0)						DrawString("\pOrc - ");		  else if (GameChars[gCurChar].race==1)				DrawString("\pGnome - ");		  else if (GameChars[gCurChar].race==2)				DrawString("\pElf - ");		  else if (GameChars[gCurChar].race==3)				DrawString("\pDwarf - ");		  else if (GameChars[gCurChar].race==4)				DrawString("\pOgre - ");			if (GameChars[gCurChar].type==0)				/* type */				DrawString("\pQueer");		else if (GameChars[gCurChar].type==1)				DrawString("\pDrag Queen");		else if (GameChars[gCurChar].type==2)				DrawString("\pMuse");		else if (GameChars[gCurChar].type==3)				DrawString("\pGuppie");		else if (GameChars[gCurChar].type==4)				DrawString("\pLesbian");		else if (GameChars[gCurChar].type==5)				DrawString("\pMaster");						RGBForeColor(&gNormName);	/* set frgcolor color to blue*/	x = 378;y = 209;for (z=0;z<=6;z++)							/* list all TYPES of items */	{		MoveTo(x+22,y+(z*20));			DrawString(GameItems[GameChars[gCurChar].items[z]].name); 	 			LocalToGlobal(&iconRect.top);			LocalToGlobal(&iconRect.bottom);		SetRect(&iconRect,x,y-13+(z*20),x+16,y+3+(z*20));	  	if (GameItems[GameChars[gCurChar].items[z]].type==SWORD)			/* sword */			PlotCIcon(&iconRect,gSwordIcon);	else if (GameItems[GameChars[gCurChar].items[z]].type==MAGICVIAL)	/* dagger */			PlotCIcon(&iconRect,gVialIcon);				else if (GameItems[GameChars[gCurChar].items[z]].type==DAGGER)		/* dagger */			PlotCIcon(&iconRect,gDaggerIcon);	else if (GameItems[GameChars[gCurChar].items[z]].type==SHIELD)		/* shield */			PlotCIcon(&iconRect,gShieldIcon);	else if (GameItems[GameChars[gCurChar].items[z]].type==ARMOR)		/* armor */			PlotCIcon(&iconRect,gArmorIcon);				else if (GameItems[GameChars[gCurChar].items[z]].type==RING)		/* ring */			PlotCIcon(&iconRect,gRingIcon);	else if (GameItems[GameChars[gCurChar].items[z]].type==SPHERE)		/* sphere */			PlotCIcon(&iconRect,gSphereIcon);	else if (GameItems[GameChars[gCurChar].items[z]].type==FLAIL)		/* flail */			PlotCIcon(&iconRect,gFlailIcon);	else if (GameItems[GameChars[gCurChar].items[z]].type==CLOAK)		/* cloak */			PlotCIcon(&iconRect,gCloakIcon);	else if (GameItems[GameChars[gCurChar].items[z]].type==HELMET)		/* Helmet */			PlotCIcon(&iconRect,gHelmetIcon);	else if (GameItems[GameChars[gCurChar].items[z]].type==GAUNTLETS)	/* gauntlets */			PlotCIcon(&iconRect,gGlovesIcon);	else if (GameItems[GameChars[gCurChar].items[z]].type==TORCH)		/* torch */			PlotCIcon(&iconRect,gTorchIcon);	else if (GameItems[GameChars[gCurChar].items[z]].type==BURNEDITEM)	/* torch */			PlotCIcon(&iconRect,gBurnedIcon);																	if (GameChars[gCurChar].itemsInUse[z] != OPENSLOT)			{				SetRect(&iconRect,365,y-12+(z*20),381,y+4+(z*20));				PlotCIcon(&iconRect,gArrowIcon);			}							}}/************************ ItemStats ****************************/ItemStats(itemNum,itemRect)				/* for Option-Clicking items */int			itemNum;Rect		itemRect;{int				itemType,x, zz,itemHit,  dialogDone = FALSE; Handle			itemHandle;Str255			text;	gDialogNum=500;	DoDialog();	if (GameItems[GameChars[gCurChar].items[itemNum]].type>=0 && 	GameItems[GameChars[gCurChar].items[itemNum]].type<=4)	 		 ParamText(GameItems[GameChars[gCurChar].items[itemNum]].name,"\pWeapon",0,0);else if (GameItems[GameChars[gCurChar].items[itemNum]].type>=4 && 	GameItems[GameChars[gCurChar].items[itemNum]].type<=8)	 		 ParamText(GameItems[GameChars[gCurChar].items[itemNum]].name,"\pArmor",0,0);else if (GameItems[GameChars[gCurChar].items[itemNum]].type==9)  		 ParamText(GameItems[GameChars[gCurChar].items[itemNum]].name,"\pJewelry",0,0);		 else if (GameItems[GameChars[gCurChar].items[itemNum]].type==11)  		 ParamText(GameItems[GameChars[gCurChar].items[itemNum]].name,"\pAccessory",0,0);		 else if (GameItems[GameChars[gCurChar].items[itemNum]].type==12)  		 ParamText(GameItems[GameChars[gCurChar].items[itemNum]].name,"\pAccessory",0,0);		 else	ParamText(GameItems[GameChars[gCurChar].items[itemNum]].name,"\pAccessory",0,0);/* NOW LIST ITEM STATS */	RGBForeColor(&gSpecName);		 	NumToString(GameItems[GameChars[gCurChar].items[itemNum]].dmg,text);		GetDItem(gCastleDialog, 8, &itemType, &itemHandle, &itemRect);		SetIText(itemHandle,text);		 			NumToString(GameItems[GameChars[gCurChar].items[itemNum]].def,text);		GetDItem(gCastleDialog, 9, &itemType, &itemHandle, &itemRect);		SetIText(itemHandle,text);				if (GameItems[GameChars[gCurChar].items[itemNum]].type==SWORD || 			GameItems[GameChars[gCurChar].items[itemNum]].type==FLAIL ||			GameItems[GameChars[gCurChar].items[itemNum]].type==ARMOR || 			GameItems[GameChars[gCurChar].items[itemNum]].type==SHIELD ||			GameItems[GameChars[gCurChar].items[itemNum]].type==GAUNTLETS || 			GameItems[GameChars[gCurChar].items[itemNum]].type==HELMET)						{					GetDItem(gCastleDialog, 10, &itemType, &itemHandle, &itemRect);			SetIText(itemHandle,"\pYes");			}			else			{			GetDItem(gCastleDialog, 10, &itemType, &itemHandle, &itemRect);			SetIText(itemHandle,"\pNo");			}				 			NumToString(GameItems[GameChars[gCurChar].items[itemNum]].con,text);		GetDItem(gCastleDialog, 11, &itemType, &itemHandle, &itemRect);		SetIText(itemHandle,text);		 			NumToString(GameItems[GameChars[gCurChar].items[itemNum]].level,text);					GetDItem(gCastleDialog, 12, &itemType, &itemHandle, &itemRect);		SetIText(itemHandle,text);		if (GameItems[GameChars[gCurChar].items[itemNum]].attrib==0)			{			GetDItem(gCastleDialog, 13, &itemType, &itemHandle, &itemRect);			SetIText(itemHandle,"\pNo");			}			else			{			GetDItem(gCastleDialog, 13, &itemType, &itemHandle, &itemRect);			SetIText(itemHandle,"\pYes");			}				RGBForeColor(&gBlack);				while (dialogDone == FALSE)		{		ModalDialog(NIL_POINTER, &itemHit);			switch (itemHit)			{				case 1:		/* LEAVE */					dialogDone = TRUE;					DisposeDialog(gCastleDialog);					SetPort(gGameWindow);					zz=-1;					return(zz);			 					break;			}	}		}/********************** PartyItemsOff *****************************/PartyItemsOff()			/* turn OFF EVERY item */{int		z,x;for (x=0;x<=gPartyNum;x++){for (z=0;z<=6;z++)	{		GameChars[x].itemsInUse[z]=OPENSLOT;	}}}/******************** GetChar ************************************/GetChar(){char			theChar;GrafPtr			oldPort;Rect			itemRect,destRect,worldBounds;int				theTime,validChar,z=FALSE;CCrsrHandle		gRedCrossCursor;gRedCrossCursor=GetCCursor(128);	/* now get color cursors */			SetCCursor(gRedCrossCursor);while (z!=TRUE)  {		if (gWNEImplemented)		WaitNextEvent(everyEvent,&gTheEvent,MIN_SLEEP,NIL_MOUSE_REGION);	else		{			SystemTask();			SndTask();			GetNextEvent(everyEvent, &gTheEvent);		}			switch (gTheEvent.what)	{		case mouseDown:		/* only look for mousedown event */	 			validChar=SelectChar();	 			DisposeCCursor(gRedCrossCursor);	 			InitCursor();	 			z=TRUE;		break;	}  }  return(validChar);}/********************** SelectChar ******************************/SelectChar(){int				validChar=-1;		/* set on entry to invalid char */WindowPtr		whichWindow;short int		thePart,direction;long int		menuChoice, windSize;Rect			destRect,worldBounds;Point			mouseLoc;GetMouse(&mouseLoc); 			thePart= FindWindow(mouseLoc, &whichWindow);	switch(thePart)	{		case inContent:						if (PtInRect(mouseLoc, &gCharRect0) && 		  			gDungParty[0] != 99)				{					Click();					validChar=0;					gWhichChar=0;					gCurChar=gDungParty[0];				}		  	else if (PtInRect(mouseLoc, &gCharRect1) && 		  			gDungParty[1] != 99)				{					Click();					validChar=0;					gWhichChar=1;					gCurChar=gDungParty[1];				}		  	else if (PtInRect(mouseLoc, &gCharRect2) && 		  			gDungParty[2] != 99)				{					Click();					validChar=0;					gWhichChar=2;					gCurChar=gDungParty[2];				}		  	else if (PtInRect(mouseLoc, &gCharRect3) && 		  			gDungParty[3] != 99)				{					Click();					validChar=0;					gWhichChar=3;					gCurChar=gDungParty[3];				}			else				validChar=-1;	/* If not on button */			break;		}	if (validChar==-1)	  {		ClearMessage();			DrawString("\pSpell failedÉ");		Pause();	   }	return(validChar);}/********************** CheckTele ******************************/CheckTele(){		if (gInEncounter==YES)						/* no teleing in encounter */			{			ClearMessage();			DrawString("\pYou can't teleport right now.");			Pause();Pause();			return(-1);			}		else			return(0);}